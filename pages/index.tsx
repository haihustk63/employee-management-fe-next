import { GetServerSideProps } from "next";
import Head from "next/head";
import { createContext, useState } from "react";

import AppModal from "@components/AppModal";
import AboutUs from "@components/pages/Home/AboutUs";
import ApplyNow from "@components/pages/Home/ApplyNow";
import Banner from "@components/pages/Home/Banner";
import EmployeeReviews from "@components/pages/Home/EmployeeReviews";
import LastestJobs from "@components/pages/Home/LastestJobs";
import Search from "@components/pages/Home/Search";
import { withServerSideProps } from "hoc/withServerSideProps";
import { candidateService } from "services/candidate";
import { positionService } from "services/position";
import Compensation from "@components/pages/Home/Compensation";
import FrequentlyAskedQuestion from "@components/pages/Home/FAQ";

export const PositionsContext = createContext({});

const submitApplyForm = async (data: any) => {
  await candidateService.postApplyForm(data);
};

export default function Home({ allPositions }: any) {
  const [visibleModal, setVisibleModal] = useState(false);

  const handleToggleModal = () => {
    setVisibleModal(!visibleModal);
  };

  return (
    <PositionsContext.Provider
      value={{ allPositions, submitApplyForm, handleToggleModal }}
    >
      <div className="homepage">
        <Head>
          <title>Create Next App</title>
          <meta name="description" content="Generated by create next app" />
          <link rel="icon" href="/favicon.ico" />
        </Head>

        <Banner />
        <div className="home-page__wrap">
          <Search />
          <LastestJobs />
          <AboutUs />
          <EmployeeReviews />
          <Compensation />
          <FrequentlyAskedQuestion />
          <ApplyNow />
        </div>
        <AppModal
          title="Example modal"
          open={visibleModal}
          onCancel={handleToggleModal}
          onOk={handleToggleModal}
        >
          <h1>Bạn đã gửi thông tin thành công!</h1>
        </AppModal>
      </div>
    </PositionsContext.Provider>
  );
}

export const getServerSideProps: GetServerSideProps = withServerSideProps(
  async () => {
    const result = await positionService.getAllPositions();
    const allPositions = result?.allPositions.map((item: any) => ({
      label: item?.name,
      value: item?.id,
      key: item?.id,
      description: item?.description,
    }));
    return { allPositions };
  }
);
